{"ast":null,"code":"\"use strict\";\n\nvar _ = require(\"lodash\");\n\nvar clc = require(\"cli-color\");\n\nvar cjson = require(\"cjson\");\n\nvar fs = require(\"fs-extra\");\n\nvar path = require(\"path\");\n\nvar detectProjectRoot = require(\"./detectProjectRoot\");\n\nvar _require = require(\"./error\"),\n    FirebaseError = _require.FirebaseError;\n\nvar fsutils = require(\"./fsutils\");\n\nvar loadCJSON = require(\"./loadCJSON\");\n\nvar parseBoltRules = require(\"./parseBoltRules\");\n\nvar _require2 = require(\"./prompt\"),\n    promptOnce = _require2.promptOnce;\n\nvar _require3 = require(\"./projectPath\"),\n    resolveProjectPath = _require3.resolveProjectPath;\n\nvar utils = require(\"./utils\");\n\nvar Config = function (src, options) {\n  this.options = options || {};\n  this.projectDir = options.projectDir || detectProjectRoot(options.cwd);\n  this._src = src;\n  this.data = {};\n  this.defaults = {};\n  this.notes = {};\n\n  if (this._src.firebase) {\n    this.defaults.project = this._src.firebase;\n    utils.logWarning(clc.bold('\"firebase\"') + \" key in firebase.json is deprecated. Run \" + clc.bold(\"firebase use --add\") + \" instead\");\n  }\n\n  if (_.has(this._src, \"rules\")) {\n    _.set(this._src, \"database.rules\", this._src.rules);\n  }\n\n  Config.MATERIALIZE_TARGETS.forEach(function (target) {\n    if (_.get(this._src, target)) {\n      _.set(this.data, target, this._materialize(target));\n    }\n  }, this);\n\n  if (this.projectDir && !this.get(\"functions.source\") && fsutils.fileExistsSync(this.path(\"functions/package.json\"))) {\n    this.set(\"functions.source\", \"functions\");\n  }\n\n  if (!this.data.hosting && this._src.public) {\n    this.importLegacyHostingKeys();\n  }\n};\n\nConfig.FILENAME = \"firebase.json\";\nConfig.MATERIALIZE_TARGETS = [\"database\", \"emulators\", \"firestore\", \"functions\", \"hosting\", \"storage\"];\nConfig.LEGACY_HOSTING_KEYS = [\"public\", \"rewrites\", \"redirects\", \"headers\", \"ignore\", \"cleanUrls\", \"trailingSlash\"];\n\nConfig.prototype.importLegacyHostingKeys = function () {\n  var found = false;\n  Config.LEGACY_HOSTING_KEYS.forEach(function (key) {\n    if (_.has(this._src, key)) {\n      found = true;\n      this.set(\"hosting.\" + key, this._src[key]);\n    }\n  }, this);\n\n  if (found) {\n    utils.logWarning('Deprecation Warning: Firebase Hosting configuration should be moved under \"hosting\" key.');\n  }\n};\n\nConfig.prototype._hasDeepKey = function (obj, key) {\n  if (_.has(obj, key)) {\n    return true;\n  }\n\n  for (var k in obj) {\n    if (_.isPlainObject(obj[k]) && this._hasDeepKey(obj[k], key)) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nConfig.prototype._materialize = function (target) {\n  var val = _.get(this._src, target);\n\n  if (_.isString(val)) {\n    var out = this._parseFile(target, val);\n\n    var lastSegment = _.last(target.split(\".\"));\n\n    if (_.size(out) === 1 && _.has(out, lastSegment)) {\n      out = out[lastSegment];\n    }\n\n    return out;\n  } else if (_.isPlainObject(val) || _.isArray(val)) {\n    return val;\n  }\n\n  throw new FirebaseError('Parse Error: \"' + target + '\" must be object or import path', {\n    exit: 1\n  });\n};\n\nConfig.prototype._parseFile = function (target, filePath) {\n  var fullPath = resolveProjectPath(this.options.cwd, filePath);\n  var ext = path.extname(filePath);\n\n  if (!fsutils.fileExistsSync(fullPath)) {\n    throw new FirebaseError(\"Parse Error: Imported file \" + filePath + \" does not exist\", {\n      exit: 1\n    });\n  }\n\n  switch (ext) {\n    case \".json\":\n      if (target === \"database\") {\n        this.notes.databaseRules = \"json\";\n      } else if (target === \"database.rules\") {\n        this.notes.databaseRulesFile = filePath;\n\n        try {\n          return fs.readFileSync(fullPath, \"utf8\");\n        } catch (e) {\n          if (e.code === \"ENOENT\") {\n            throw new FirebaseError(`File not found: ${fullPath}`, {\n              original: e\n            });\n          }\n\n          throw e;\n        }\n      }\n\n      return loadCJSON(fullPath);\n\n    case \".bolt\":\n      if (target === \"database\") {\n        this.notes.databaseRules = \"bolt\";\n      }\n\n      return parseBoltRules(fullPath);\n\n    default:\n      throw new FirebaseError(\"Parse Error: \" + filePath + \" is not of a supported config file type\", {\n        exit: 1\n      });\n  }\n};\n\nConfig.prototype.get = function (key, fallback) {\n  return _.get(this.data, key, fallback);\n};\n\nConfig.prototype.set = function (key, value) {\n  return _.set(this.data, key, value);\n};\n\nConfig.prototype.has = function (key) {\n  return _.has(this.data, key);\n};\n\nConfig.prototype.path = function (pathName) {\n  var outPath = path.normalize(path.join(this.projectDir, pathName));\n\n  if (_.includes(path.relative(this.projectDir, outPath), \"..\")) {\n    throw new FirebaseError(clc.bold(pathName) + \" is outside of project directory\", {\n      exit: 1\n    });\n  }\n\n  return outPath;\n};\n\nConfig.prototype.readProjectFile = function (p, options) {\n  options = options || {};\n\n  try {\n    var content = fs.readFileSync(this.path(p), \"utf8\");\n\n    if (options.json) {\n      return JSON.parse(content);\n    }\n\n    return content;\n  } catch (e) {\n    if (options.fallback) {\n      return options.fallback;\n    }\n\n    if (e.code === \"ENOENT\") {\n      throw new FirebaseError(`File not found: ${this.path(p)}`, {\n        original: e\n      });\n    }\n\n    throw e;\n  }\n};\n\nConfig.prototype.writeProjectFile = function (p, content) {\n  if (typeof content !== \"string\") {\n    content = JSON.stringify(content, null, 2) + \"\\n\";\n  }\n\n  fs.ensureFileSync(this.path(p));\n  fs.writeFileSync(this.path(p), content, \"utf8\");\n};\n\nConfig.prototype.askWriteProjectFile = function (p, content) {\n  var writeTo = this.path(p);\n  var next;\n\n  if (fsutils.fileExistsSync(writeTo)) {\n    next = promptOnce({\n      type: \"confirm\",\n      message: \"File \" + clc.underline(p) + \" already exists. Overwrite?\",\n      default: false\n    });\n  } else {\n    next = Promise.resolve(true);\n  }\n\n  var self = this;\n  return next.then(function (result) {\n    if (result) {\n      self.writeProjectFile(p, content);\n      utils.logSuccess(\"Wrote \" + clc.bold(p));\n    } else {\n      utils.logBullet(\"Skipping write of \" + clc.bold(p));\n    }\n  });\n};\n\nConfig.load = function (options, allowMissing) {\n  var pd = detectProjectRoot(options.cwd);\n\n  if (pd) {\n    try {\n      var data = cjson.load(path.join(pd, Config.FILENAME));\n      return new Config(data, options);\n    } catch (e) {\n      throw new FirebaseError(\"There was an error loading firebase.json:\\n\\n\" + e.message, {\n        exit: 1\n      });\n    }\n  }\n\n  if (allowMissing) {\n    return null;\n  }\n\n  throw new FirebaseError(\"Not in a Firebase app directory (could not locate firebase.json)\", {\n    exit: 1\n  });\n};\n\nmodule.exports = Config;","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/config.js"],"names":["_","require","clc","cjson","fs","path","detectProjectRoot","FirebaseError","fsutils","loadCJSON","parseBoltRules","promptOnce","resolveProjectPath","utils","Config","src","options","projectDir","cwd","_src","data","defaults","notes","firebase","project","logWarning","bold","has","set","rules","MATERIALIZE_TARGETS","forEach","target","get","_materialize","fileExistsSync","hosting","public","importLegacyHostingKeys","FILENAME","LEGACY_HOSTING_KEYS","prototype","found","key","_hasDeepKey","obj","k","isPlainObject","val","isString","out","_parseFile","lastSegment","last","split","size","isArray","exit","filePath","fullPath","ext","extname","databaseRules","databaseRulesFile","readFileSync","e","code","original","fallback","value","pathName","outPath","normalize","join","includes","relative","readProjectFile","p","content","json","JSON","parse","writeProjectFile","stringify","ensureFileSync","writeFileSync","askWriteProjectFile","writeTo","next","type","message","underline","default","Promise","resolve","self","then","result","logSuccess","logBullet","load","allowMissing","pd","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _ = require(\"lodash\");\nvar clc = require(\"cli-color\");\nvar cjson = require(\"cjson\");\nvar fs = require(\"fs-extra\");\nvar path = require(\"path\");\nvar detectProjectRoot = require(\"./detectProjectRoot\");\nvar { FirebaseError } = require(\"./error\");\nvar fsutils = require(\"./fsutils\");\nvar loadCJSON = require(\"./loadCJSON\");\nvar parseBoltRules = require(\"./parseBoltRules\");\nvar { promptOnce } = require(\"./prompt\");\nvar { resolveProjectPath } = require(\"./projectPath\");\nvar utils = require(\"./utils\");\nvar Config = function (src, options) {\n    this.options = options || {};\n    this.projectDir = options.projectDir || detectProjectRoot(options.cwd);\n    this._src = src;\n    this.data = {};\n    this.defaults = {};\n    this.notes = {};\n    if (this._src.firebase) {\n        this.defaults.project = this._src.firebase;\n        utils.logWarning(clc.bold('\"firebase\"') +\n            \" key in firebase.json is deprecated. Run \" +\n            clc.bold(\"firebase use --add\") +\n            \" instead\");\n    }\n    if (_.has(this._src, \"rules\")) {\n        _.set(this._src, \"database.rules\", this._src.rules);\n    }\n    Config.MATERIALIZE_TARGETS.forEach(function (target) {\n        if (_.get(this._src, target)) {\n            _.set(this.data, target, this._materialize(target));\n        }\n    }, this);\n    if (this.projectDir &&\n        !this.get(\"functions.source\") &&\n        fsutils.fileExistsSync(this.path(\"functions/package.json\"))) {\n        this.set(\"functions.source\", \"functions\");\n    }\n    if (!this.data.hosting && this._src.public) {\n        this.importLegacyHostingKeys();\n    }\n};\nConfig.FILENAME = \"firebase.json\";\nConfig.MATERIALIZE_TARGETS = [\n    \"database\",\n    \"emulators\",\n    \"firestore\",\n    \"functions\",\n    \"hosting\",\n    \"storage\",\n];\nConfig.LEGACY_HOSTING_KEYS = [\n    \"public\",\n    \"rewrites\",\n    \"redirects\",\n    \"headers\",\n    \"ignore\",\n    \"cleanUrls\",\n    \"trailingSlash\",\n];\nConfig.prototype.importLegacyHostingKeys = function () {\n    var found = false;\n    Config.LEGACY_HOSTING_KEYS.forEach(function (key) {\n        if (_.has(this._src, key)) {\n            found = true;\n            this.set(\"hosting.\" + key, this._src[key]);\n        }\n    }, this);\n    if (found) {\n        utils.logWarning('Deprecation Warning: Firebase Hosting configuration should be moved under \"hosting\" key.');\n    }\n};\nConfig.prototype._hasDeepKey = function (obj, key) {\n    if (_.has(obj, key)) {\n        return true;\n    }\n    for (var k in obj) {\n        if (_.isPlainObject(obj[k]) && this._hasDeepKey(obj[k], key)) {\n            return true;\n        }\n    }\n    return false;\n};\nConfig.prototype._materialize = function (target) {\n    var val = _.get(this._src, target);\n    if (_.isString(val)) {\n        var out = this._parseFile(target, val);\n        var lastSegment = _.last(target.split(\".\"));\n        if (_.size(out) === 1 && _.has(out, lastSegment)) {\n            out = out[lastSegment];\n        }\n        return out;\n    }\n    else if (_.isPlainObject(val) || _.isArray(val)) {\n        return val;\n    }\n    throw new FirebaseError('Parse Error: \"' + target + '\" must be object or import path', {\n        exit: 1,\n    });\n};\nConfig.prototype._parseFile = function (target, filePath) {\n    var fullPath = resolveProjectPath(this.options.cwd, filePath);\n    var ext = path.extname(filePath);\n    if (!fsutils.fileExistsSync(fullPath)) {\n        throw new FirebaseError(\"Parse Error: Imported file \" + filePath + \" does not exist\", {\n            exit: 1,\n        });\n    }\n    switch (ext) {\n        case \".json\":\n            if (target === \"database\") {\n                this.notes.databaseRules = \"json\";\n            }\n            else if (target === \"database.rules\") {\n                this.notes.databaseRulesFile = filePath;\n                try {\n                    return fs.readFileSync(fullPath, \"utf8\");\n                }\n                catch (e) {\n                    if (e.code === \"ENOENT\") {\n                        throw new FirebaseError(`File not found: ${fullPath}`, { original: e });\n                    }\n                    throw e;\n                }\n            }\n            return loadCJSON(fullPath);\n        case \".bolt\":\n            if (target === \"database\") {\n                this.notes.databaseRules = \"bolt\";\n            }\n            return parseBoltRules(fullPath);\n        default:\n            throw new FirebaseError(\"Parse Error: \" + filePath + \" is not of a supported config file type\", { exit: 1 });\n    }\n};\nConfig.prototype.get = function (key, fallback) {\n    return _.get(this.data, key, fallback);\n};\nConfig.prototype.set = function (key, value) {\n    return _.set(this.data, key, value);\n};\nConfig.prototype.has = function (key) {\n    return _.has(this.data, key);\n};\nConfig.prototype.path = function (pathName) {\n    var outPath = path.normalize(path.join(this.projectDir, pathName));\n    if (_.includes(path.relative(this.projectDir, outPath), \"..\")) {\n        throw new FirebaseError(clc.bold(pathName) + \" is outside of project directory\", { exit: 1 });\n    }\n    return outPath;\n};\nConfig.prototype.readProjectFile = function (p, options) {\n    options = options || {};\n    try {\n        var content = fs.readFileSync(this.path(p), \"utf8\");\n        if (options.json) {\n            return JSON.parse(content);\n        }\n        return content;\n    }\n    catch (e) {\n        if (options.fallback) {\n            return options.fallback;\n        }\n        if (e.code === \"ENOENT\") {\n            throw new FirebaseError(`File not found: ${this.path(p)}`, { original: e });\n        }\n        throw e;\n    }\n};\nConfig.prototype.writeProjectFile = function (p, content) {\n    if (typeof content !== \"string\") {\n        content = JSON.stringify(content, null, 2) + \"\\n\";\n    }\n    fs.ensureFileSync(this.path(p));\n    fs.writeFileSync(this.path(p), content, \"utf8\");\n};\nConfig.prototype.askWriteProjectFile = function (p, content) {\n    var writeTo = this.path(p);\n    var next;\n    if (fsutils.fileExistsSync(writeTo)) {\n        next = promptOnce({\n            type: \"confirm\",\n            message: \"File \" + clc.underline(p) + \" already exists. Overwrite?\",\n            default: false,\n        });\n    }\n    else {\n        next = Promise.resolve(true);\n    }\n    var self = this;\n    return next.then(function (result) {\n        if (result) {\n            self.writeProjectFile(p, content);\n            utils.logSuccess(\"Wrote \" + clc.bold(p));\n        }\n        else {\n            utils.logBullet(\"Skipping write of \" + clc.bold(p));\n        }\n    });\n};\nConfig.load = function (options, allowMissing) {\n    var pd = detectProjectRoot(options.cwd);\n    if (pd) {\n        try {\n            var data = cjson.load(path.join(pd, Config.FILENAME));\n            return new Config(data, options);\n        }\n        catch (e) {\n            throw new FirebaseError(\"There was an error loading firebase.json:\\n\\n\" + e.message, {\n                exit: 1,\n            });\n        }\n    }\n    if (allowMissing) {\n        return null;\n    }\n    throw new FirebaseError(\"Not in a Firebase app directory (could not locate firebase.json)\", {\n        exit: 1,\n    });\n};\nmodule.exports = Config;\n"]},"metadata":{},"sourceType":"script"}