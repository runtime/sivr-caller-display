{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst lodash_1 = require(\"lodash\");\n\nconst cli_color_1 = require(\"cli-color\");\n\nconst api_1 = require(\"./api\");\n\nconst getProjectId = require(\"./getProjectId\");\n\nconst requireAuth = require(\"./requireAuth\");\n\nconst logger_1 = require(\"./logger\");\n\nconst error_1 = require(\"./error\");\n\nconst BASE_PERMISSIONS = [\"firebase.projects.get\"];\n\nfunction requirePermissions(options, permissions = []) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const projectId = getProjectId(options);\n    const requiredPermissions = BASE_PERMISSIONS.concat(permissions).sort();\n    yield requireAuth(options);\n    logger_1.debug(`[iam] checking project ${projectId} for permissions ${JSON.stringify(requiredPermissions)}`);\n    let response;\n\n    try {\n      response = yield api_1.request(\"POST\", `/v1/projects/${projectId}:testIamPermissions`, {\n        auth: true,\n        data: {\n          permissions: requiredPermissions\n        },\n        origin: api_1.resourceManagerOrigin\n      });\n    } catch (err) {\n      logger_1.debug(`[iam] error while checking permissions, command may fail: ${err}`);\n      return;\n    }\n\n    const allowedPermissions = (response.body.permissions || []).sort();\n    const missingPermissions = lodash_1.difference(requiredPermissions, allowedPermissions);\n\n    if (missingPermissions.length) {\n      throw new error_1.FirebaseError(`Authorization failed. This account is missing the following required permissions on project ${cli_color_1.bold(projectId)}:\\n\\n  ${missingPermissions.join(\"\\n  \")}`);\n    }\n  });\n}\n\nexports.requirePermissions = requirePermissions;","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/requirePermissions.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","lodash_1","require","cli_color_1","api_1","getProjectId","requireAuth","logger_1","error_1","BASE_PERMISSIONS","requirePermissions","options","permissions","projectId","requiredPermissions","concat","sort","debug","JSON","stringify","response","request","auth","data","origin","resourceManagerOrigin","err","allowedPermissions","body","missingPermissions","difference","length","FirebaseError","bold","join"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst lodash_1 = require(\"lodash\");\nconst cli_color_1 = require(\"cli-color\");\nconst api_1 = require(\"./api\");\nconst getProjectId = require(\"./getProjectId\");\nconst requireAuth = require(\"./requireAuth\");\nconst logger_1 = require(\"./logger\");\nconst error_1 = require(\"./error\");\nconst BASE_PERMISSIONS = [\"firebase.projects.get\"];\nfunction requirePermissions(options, permissions = []) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const projectId = getProjectId(options);\n        const requiredPermissions = BASE_PERMISSIONS.concat(permissions).sort();\n        yield requireAuth(options);\n        logger_1.debug(`[iam] checking project ${projectId} for permissions ${JSON.stringify(requiredPermissions)}`);\n        let response;\n        try {\n            response = yield api_1.request(\"POST\", `/v1/projects/${projectId}:testIamPermissions`, {\n                auth: true,\n                data: { permissions: requiredPermissions },\n                origin: api_1.resourceManagerOrigin,\n            });\n        }\n        catch (err) {\n            logger_1.debug(`[iam] error while checking permissions, command may fail: ${err}`);\n            return;\n        }\n        const allowedPermissions = (response.body.permissions || []).sort();\n        const missingPermissions = lodash_1.difference(requiredPermissions, allowedPermissions);\n        if (missingPermissions.length) {\n            throw new error_1.FirebaseError(`Authorization failed. This account is missing the following required permissions on project ${cli_color_1.bold(projectId)}:\\n\\n  ${missingPermissions.join(\"\\n  \")}`);\n        }\n    });\n}\nexports.requirePermissions = requirePermissions;\n"]},"metadata":{},"sourceType":"script"}