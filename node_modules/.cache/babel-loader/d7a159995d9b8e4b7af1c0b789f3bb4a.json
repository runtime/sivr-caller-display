{"ast":null,"code":"/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n * Use of this source code is governed by a BSD-style\n * license that can be found in the LICENSE file or at\n * https://github.com/firebase/superstatic/blob/master/LICENSE\n */\n'use strict';\n\nvar middleware = require('./middleware');\n\nvar _ = require('lodash');\n\nvar promiseback = require('./utils/promiseback');\n\nvar RSVP = require('rsvp');\n\nvar Activator = function (spec, provider) {\n  this.spec = spec;\n  this.provider = provider;\n  this.stack = this.buildStack();\n\n  if (_.isFunction(spec.config)) {\n    this.awaitConfig = spec.config;\n  } else {\n    this.awaitConfig = function () {\n      return RSVP.resolve(spec.config);\n    };\n  }\n};\n\nActivator.prototype.buildStack = function () {\n  var self = this;\n  var stack = this.spec.stack.slice(0);\n\n  _.forEach(this.spec.before, function (wares, name) {\n    stack.splice.apply(stack, [stack.indexOf(name), 0].concat(wares));\n  });\n\n  _.forEach(this.spec.after, function (wares, name) {\n    stack.splice.apply(stack, [stack.indexOf(name) + 1, 0].concat(wares));\n  });\n\n  return stack.map(function (ware) {\n    return _.isFunction(ware) ? ware : middleware[ware](self.spec);\n  });\n};\n\nActivator.prototype.build = function () {\n  var self = this;\n  return function (req, res, next) {\n    promiseback(self.awaitConfig, 2)(req, res).then(function (config) {\n      req.superstatic = config || {};\n      var stack = self.stack.slice(0).reverse();\n\n      var _run = function () {\n        if (!stack.length) {\n          return next();\n        }\n\n        var fn = stack.pop();\n        return fn(req, res, _run);\n      };\n\n      _run();\n    }, next);\n  };\n};\n\nmodule.exports = function (spec, provider) {\n  return new Activator(spec, provider).build();\n};","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/superstatic/lib/activator.js"],"names":["middleware","require","_","promiseback","RSVP","Activator","spec","provider","stack","buildStack","isFunction","config","awaitConfig","resolve","prototype","self","slice","forEach","before","wares","name","splice","apply","indexOf","concat","after","map","ware","build","req","res","next","then","superstatic","reverse","_run","length","fn","pop","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n * Use of this source code is governed by a BSD-style\n * license that can be found in the LICENSE file or at\n * https://github.com/firebase/superstatic/blob/master/LICENSE\n */\n'use strict';\n\nvar middleware = require('./middleware');\nvar _ = require('lodash');\nvar promiseback = require('./utils/promiseback');\nvar RSVP = require('rsvp');\n\nvar Activator = function(spec, provider) {\n  this.spec = spec;\n  this.provider = provider;\n  this.stack = this.buildStack();\n\n  if (_.isFunction(spec.config)) {\n    this.awaitConfig = spec.config;\n  } else {\n    this.awaitConfig = function() {\n      return RSVP.resolve(spec.config);\n    };\n  }\n};\n\nActivator.prototype.buildStack = function() {\n  var self = this;\n\n  var stack = this.spec.stack.slice(0);\n  _.forEach(this.spec.before, function(wares, name) {\n    stack.splice.apply(stack, [stack.indexOf(name), 0].concat(wares));\n  });\n\n  _.forEach(this.spec.after, function(wares, name) {\n    stack.splice.apply(stack, [stack.indexOf(name) + 1, 0].concat(wares));\n  });\n\n  return stack.map(function(ware) {\n    return _.isFunction(ware) ? ware : middleware[ware](self.spec);\n  });\n};\n\nActivator.prototype.build = function() {\n  var self = this;\n\n  return function(req, res, next) {\n    promiseback(self.awaitConfig, 2)(req, res).then(function(config) {\n      req.superstatic = config || {};\n\n      var stack = self.stack.slice(0).reverse();\n      var _run = function() {\n        if (!stack.length) {\n          return next();\n        }\n        var fn = stack.pop();\n        return fn(req, res, _run);\n      };\n\n      _run();\n    }, next);\n  };\n};\n\nmodule.exports = function(spec, provider) {\n  return new Activator(spec, provider).build();\n};\n"]},"metadata":{},"sourceType":"script"}