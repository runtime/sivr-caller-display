{"ast":null,"code":"\"use strict\";\n\nvar _ = require(\"lodash\");\n\nvar querystring = require(\"querystring\");\n\nvar request = require(\"request\");\n\nvar _require = require(\"./error\"),\n    FirebaseError = _require.FirebaseError;\n\nvar logger = require(\"./logger\");\n\nvar responseToError = require(\"./responseToError\");\n\nvar scopes = require(\"./scopes\");\n\nvar utils = require(\"./utils\");\n\nvar CLI_VERSION = require(\"../package.json\").version;\n\nvar accessToken;\nvar refreshToken;\nvar commandScopes;\n\nvar _request = function (options, logOptions) {\n  logOptions = logOptions || {};\n  var qsLog = \"\";\n  var bodyLog = \"<request body omitted>\";\n\n  if (options.qs && !logOptions.skipQueryParams) {\n    qsLog = JSON.stringify(options.qs);\n  }\n\n  if (!logOptions.skipRequestBody) {\n    bodyLog = options.body || options.form || \"\";\n  }\n\n  logger.debug(\">>> HTTP REQUEST\", options.method, options.url, qsLog, \"\\n\", bodyLog);\n  options.headers = options.headers || {};\n  options.headers[\"connection\"] = \"keep-alive\";\n  return new Promise(function (resolve, reject) {\n    var req = request(options, function (err, response, body) {\n      if (err) {\n        return reject(new FirebaseError(\"Server Error. \" + err.message, {\n          original: err,\n          exit: 2\n        }));\n      }\n\n      logger.debug(\"<<< HTTP RESPONSE\", response.statusCode, response.headers);\n\n      if (response.statusCode >= 400 && !logOptions.skipResponseBody) {\n        logger.debug(\"<<< HTTP RESPONSE BODY\", response.body);\n\n        if (!options.resolveOnHTTPError) {\n          return reject(responseToError(response, body, options));\n        }\n      }\n\n      return resolve({\n        status: response.statusCode,\n        response: response,\n        body: body\n      });\n    });\n\n    if (_.size(options.files) > 0) {\n      var form = req.form();\n\n      _.forEach(options.files, function (details, param) {\n        form.append(param, details.stream, {\n          knownLength: details.knownLength,\n          filename: details.filename,\n          contentType: details.contentType\n        });\n      });\n    }\n  });\n};\n\nvar _appendQueryData = function (path, data) {\n  if (data && _.size(data) > 0) {\n    path += _.includes(path, \"?\") ? \"&\" : \"?\";\n    path += querystring.stringify(data);\n  }\n\n  return path;\n};\n\nvar api = {\n  clientId: utils.envOverride(\"FIREBASE_CLIENT_ID\", \"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com\"),\n  clientSecret: utils.envOverride(\"FIREBASE_CLIENT_SECRET\", \"j9iVZfS8kkCEFUPaAeJV0sAi\"),\n  cloudbillingOrigin: utils.envOverride(\"FIREBASE_CLOUDBILLING_URL\", \"https://cloudbilling.googleapis.com\"),\n  cloudloggingOrigin: utils.envOverride(\"FIREBASE_CLOUDLOGGING_URL\", \"https://logging.googleapis.com\"),\n  adminOrigin: utils.envOverride(\"FIREBASE_ADMIN_URL\", \"https://admin.firebase.com\"),\n  appDistributionOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_URL\", \"https://firebaseappdistribution.googleapis.com\"),\n  appDistributionUploadOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_UPLOAD_URL\", \"https://appdistribution-uploads.crashlytics.com\"),\n  appengineOrigin: utils.envOverride(\"FIREBASE_APPENGINE_URL\", \"https://appengine.googleapis.com\"),\n  authOrigin: utils.envOverride(\"FIREBASE_AUTH_URL\", \"https://accounts.google.com\"),\n  consoleOrigin: utils.envOverride(\"FIREBASE_CONSOLE_URL\", \"https://console.firebase.google.com\"),\n  deployOrigin: utils.envOverride(\"FIREBASE_DEPLOY_URL\", utils.envOverride(\"FIREBASE_UPLOAD_URL\", \"https://deploy.firebase.com\")),\n  firebaseApiOrigin: utils.envOverride(\"FIREBASE_API_URL\", \"https://firebase.googleapis.com\"),\n  firebaseExtensionsRegistryOrigin: utils.envOverride(\"FIREBASE_EXT_REGISTRY_ORIGIN\", \"https://extensions-registry.firebaseapp.com\"),\n  firedataOrigin: utils.envOverride(\"FIREBASE_FIREDATA_URL\", \"https://mobilesdk-pa.googleapis.com\"),\n  firestoreOrigin: utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"),\n  functionsOrigin: utils.envOverride(\"FIREBASE_FUNCTIONS_URL\", \"https://cloudfunctions.googleapis.com\"),\n  cloudschedulerOrigin: utils.envOverride(\"FIREBASE_CLOUDSCHEDULER_URL\", \"https://cloudscheduler.googleapis.com\"),\n  pubsubOrigin: utils.envOverride(\"FIREBASE_PUBSUB_URL\", \"https://pubsub.googleapis.com\"),\n  googleOrigin: utils.envOverride(\"FIREBASE_TOKEN_URL\", utils.envOverride(\"FIREBASE_GOOGLE_URL\", \"https://www.googleapis.com\")),\n  hostingOrigin: utils.envOverride(\"FIREBASE_HOSTING_URL\", \"https://firebaseapp.com\"),\n  iamOrigin: utils.envOverride(\"FIREBASE_IAM_URL\", \"https://iam.googleapis.com\"),\n  extensionsOrigin: utils.envOverride(\"FIREBASE_EXT_URL\", \"https://firebaseextensions.googleapis.com\"),\n  realtimeOrigin: utils.envOverride(\"FIREBASE_REALTIME_URL\", \"https://firebaseio.com\"),\n  rtdbMetadataOrigin: utils.envOverride(\"FIREBASE_RTDB_METADATA_URL\", \"https://metadata-dot-firebase-prod.appspot.com\"),\n  resourceManagerOrigin: utils.envOverride(\"FIREBASE_RESOURCEMANAGER_URL\", \"https://cloudresourcemanager.googleapis.com\"),\n  rulesOrigin: utils.envOverride(\"FIREBASE_RULES_URL\", \"https://firebaserules.googleapis.com\"),\n  runtimeconfigOrigin: utils.envOverride(\"FIREBASE_RUNTIMECONFIG_URL\", \"https://runtimeconfig.googleapis.com\"),\n  storageOrigin: utils.envOverride(\"FIREBASE_STORAGE_URL\", \"https://storage.googleapis.com\"),\n  hostingApiOrigin: utils.envOverride(\"FIREBASE_HOSTING_API_URL\", \"https://firebasehosting.googleapis.com\"),\n  cloudRunApiOrigin: utils.envOverride(\"CLOUD_RUN_API_URL\", \"https://run.googleapis.com\"),\n  serviceUsageOrigin: utils.envOverride(\"FIREBASE_SERVICE_USAGE_URL\", \"https://serviceusage.googleapis.com\"),\n  setRefreshToken: function (token) {\n    refreshToken = token;\n  },\n  setAccessToken: function (token) {\n    accessToken = token;\n  },\n  getScopes: function () {\n    return commandScopes;\n  },\n  setScopes: function (s) {\n    commandScopes = _.uniq(_.flatten([scopes.EMAIL, scopes.OPENID, scopes.CLOUD_PROJECTS_READONLY, scopes.FIREBASE_PLATFORM].concat(s || [])));\n    logger.debug(\"> command requires scopes:\", JSON.stringify(commandScopes));\n  },\n  getAccessToken: function () {\n    return accessToken ? Promise.resolve({\n      access_token: accessToken\n    }) : require(\"./auth\").getAccessToken(refreshToken, commandScopes);\n  },\n  addRequestHeaders: function (reqOptions) {\n    _.set(reqOptions, [\"headers\", \"User-Agent\"], \"FirebaseCLI/\" + CLI_VERSION);\n\n    _.set(reqOptions, [\"headers\", \"X-Client-Version\"], \"FirebaseCLI/\" + CLI_VERSION);\n\n    return api.getAccessToken().then(function (result) {\n      _.set(reqOptions, \"headers.authorization\", \"Bearer \" + result.access_token);\n\n      return reqOptions;\n    });\n  },\n  request: function (method, resource, options) {\n    options = _.extend({\n      data: {},\n      origin: api.adminOrigin,\n      resolveOnHTTPError: false,\n      json: true\n    }, options);\n    var validMethods = [\"GET\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"];\n\n    if (validMethods.indexOf(method) < 0) {\n      method = \"GET\";\n    }\n\n    var reqOptions = {\n      method: method\n    };\n\n    if (options.query) {\n      resource = _appendQueryData(resource, options.query);\n    }\n\n    if (method === \"GET\") {\n      resource = _appendQueryData(resource, options.data);\n    } else {\n      if (_.size(options.data) > 0) {\n        reqOptions.body = options.data;\n      } else if (_.size(options.form) > 0) {\n        reqOptions.form = options.form;\n      }\n    }\n\n    reqOptions.url = options.origin + resource;\n    reqOptions.files = options.files;\n    reqOptions.resolveOnHTTPError = options.resolveOnHTTPError;\n    reqOptions.json = options.json;\n    reqOptions.qs = options.qs;\n    reqOptions.headers = options.headers;\n    reqOptions.timeout = options.timeout;\n\n    var requestFunction = function () {\n      return _request(reqOptions, options.logOptions);\n    };\n\n    if (options.auth === true) {\n      requestFunction = function () {\n        return api.addRequestHeaders(reqOptions).then(function (reqOptionsWithToken) {\n          return _request(reqOptionsWithToken, options.logOptions);\n        });\n      };\n    }\n\n    return requestFunction().catch(function (err) {\n      if (options.retryCodes && _.includes(options.retryCodes, _.get(err, \"context.response.statusCode\"))) {\n        return new Promise(function (resolve) {\n          setTimeout(resolve, 1000);\n        }).then(requestFunction);\n      }\n\n      return Promise.reject(err);\n    });\n  },\n  getProjects: function () {\n    logger.debug(`[WARNING] ${new Error(\"getProjects() is deprecated - update the implementation\").stack}`);\n    return api.request(\"GET\", \"/v1/projects\", {\n      auth: true\n    }).then(function (res) {\n      if (res.body && res.body.projects) {\n        return res.body.projects;\n      }\n\n      return Promise.reject(new FirebaseError(\"Server Error: Unexpected Response. Please try again\", {\n        context: res,\n        exit: 2\n      }));\n    });\n  }\n};\nmodule.exports = api;","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/api.js"],"names":["_","require","querystring","request","FirebaseError","logger","responseToError","scopes","utils","CLI_VERSION","version","accessToken","refreshToken","commandScopes","_request","options","logOptions","qsLog","bodyLog","qs","skipQueryParams","JSON","stringify","skipRequestBody","body","form","debug","method","url","headers","Promise","resolve","reject","req","err","response","message","original","exit","statusCode","skipResponseBody","resolveOnHTTPError","status","size","files","forEach","details","param","append","stream","knownLength","filename","contentType","_appendQueryData","path","data","includes","api","clientId","envOverride","clientSecret","cloudbillingOrigin","cloudloggingOrigin","adminOrigin","appDistributionOrigin","appDistributionUploadOrigin","appengineOrigin","authOrigin","consoleOrigin","deployOrigin","firebaseApiOrigin","firebaseExtensionsRegistryOrigin","firedataOrigin","firestoreOrigin","functionsOrigin","cloudschedulerOrigin","pubsubOrigin","googleOrigin","hostingOrigin","iamOrigin","extensionsOrigin","realtimeOrigin","rtdbMetadataOrigin","resourceManagerOrigin","rulesOrigin","runtimeconfigOrigin","storageOrigin","hostingApiOrigin","cloudRunApiOrigin","serviceUsageOrigin","setRefreshToken","token","setAccessToken","getScopes","setScopes","s","uniq","flatten","EMAIL","OPENID","CLOUD_PROJECTS_READONLY","FIREBASE_PLATFORM","concat","getAccessToken","access_token","addRequestHeaders","reqOptions","set","then","result","resource","extend","origin","json","validMethods","indexOf","query","timeout","requestFunction","auth","reqOptionsWithToken","catch","retryCodes","get","setTimeout","getProjects","Error","stack","res","projects","context","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _ = require(\"lodash\");\nvar querystring = require(\"querystring\");\nvar request = require(\"request\");\nvar { FirebaseError } = require(\"./error\");\nvar logger = require(\"./logger\");\nvar responseToError = require(\"./responseToError\");\nvar scopes = require(\"./scopes\");\nvar utils = require(\"./utils\");\nvar CLI_VERSION = require(\"../package.json\").version;\nvar accessToken;\nvar refreshToken;\nvar commandScopes;\nvar _request = function (options, logOptions) {\n    logOptions = logOptions || {};\n    var qsLog = \"\";\n    var bodyLog = \"<request body omitted>\";\n    if (options.qs && !logOptions.skipQueryParams) {\n        qsLog = JSON.stringify(options.qs);\n    }\n    if (!logOptions.skipRequestBody) {\n        bodyLog = options.body || options.form || \"\";\n    }\n    logger.debug(\">>> HTTP REQUEST\", options.method, options.url, qsLog, \"\\n\", bodyLog);\n    options.headers = options.headers || {};\n    options.headers[\"connection\"] = \"keep-alive\";\n    return new Promise(function (resolve, reject) {\n        var req = request(options, function (err, response, body) {\n            if (err) {\n                return reject(new FirebaseError(\"Server Error. \" + err.message, {\n                    original: err,\n                    exit: 2,\n                }));\n            }\n            logger.debug(\"<<< HTTP RESPONSE\", response.statusCode, response.headers);\n            if (response.statusCode >= 400 && !logOptions.skipResponseBody) {\n                logger.debug(\"<<< HTTP RESPONSE BODY\", response.body);\n                if (!options.resolveOnHTTPError) {\n                    return reject(responseToError(response, body, options));\n                }\n            }\n            return resolve({\n                status: response.statusCode,\n                response: response,\n                body: body,\n            });\n        });\n        if (_.size(options.files) > 0) {\n            var form = req.form();\n            _.forEach(options.files, function (details, param) {\n                form.append(param, details.stream, {\n                    knownLength: details.knownLength,\n                    filename: details.filename,\n                    contentType: details.contentType,\n                });\n            });\n        }\n    });\n};\nvar _appendQueryData = function (path, data) {\n    if (data && _.size(data) > 0) {\n        path += _.includes(path, \"?\") ? \"&\" : \"?\";\n        path += querystring.stringify(data);\n    }\n    return path;\n};\nvar api = {\n    clientId: utils.envOverride(\"FIREBASE_CLIENT_ID\", \"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com\"),\n    clientSecret: utils.envOverride(\"FIREBASE_CLIENT_SECRET\", \"j9iVZfS8kkCEFUPaAeJV0sAi\"),\n    cloudbillingOrigin: utils.envOverride(\"FIREBASE_CLOUDBILLING_URL\", \"https://cloudbilling.googleapis.com\"),\n    cloudloggingOrigin: utils.envOverride(\"FIREBASE_CLOUDLOGGING_URL\", \"https://logging.googleapis.com\"),\n    adminOrigin: utils.envOverride(\"FIREBASE_ADMIN_URL\", \"https://admin.firebase.com\"),\n    appDistributionOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_URL\", \"https://firebaseappdistribution.googleapis.com\"),\n    appDistributionUploadOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_UPLOAD_URL\", \"https://appdistribution-uploads.crashlytics.com\"),\n    appengineOrigin: utils.envOverride(\"FIREBASE_APPENGINE_URL\", \"https://appengine.googleapis.com\"),\n    authOrigin: utils.envOverride(\"FIREBASE_AUTH_URL\", \"https://accounts.google.com\"),\n    consoleOrigin: utils.envOverride(\"FIREBASE_CONSOLE_URL\", \"https://console.firebase.google.com\"),\n    deployOrigin: utils.envOverride(\"FIREBASE_DEPLOY_URL\", utils.envOverride(\"FIREBASE_UPLOAD_URL\", \"https://deploy.firebase.com\")),\n    firebaseApiOrigin: utils.envOverride(\"FIREBASE_API_URL\", \"https://firebase.googleapis.com\"),\n    firebaseExtensionsRegistryOrigin: utils.envOverride(\"FIREBASE_EXT_REGISTRY_ORIGIN\", \"https://extensions-registry.firebaseapp.com\"),\n    firedataOrigin: utils.envOverride(\"FIREBASE_FIREDATA_URL\", \"https://mobilesdk-pa.googleapis.com\"),\n    firestoreOrigin: utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"),\n    functionsOrigin: utils.envOverride(\"FIREBASE_FUNCTIONS_URL\", \"https://cloudfunctions.googleapis.com\"),\n    cloudschedulerOrigin: utils.envOverride(\"FIREBASE_CLOUDSCHEDULER_URL\", \"https://cloudscheduler.googleapis.com\"),\n    pubsubOrigin: utils.envOverride(\"FIREBASE_PUBSUB_URL\", \"https://pubsub.googleapis.com\"),\n    googleOrigin: utils.envOverride(\"FIREBASE_TOKEN_URL\", utils.envOverride(\"FIREBASE_GOOGLE_URL\", \"https://www.googleapis.com\")),\n    hostingOrigin: utils.envOverride(\"FIREBASE_HOSTING_URL\", \"https://firebaseapp.com\"),\n    iamOrigin: utils.envOverride(\"FIREBASE_IAM_URL\", \"https://iam.googleapis.com\"),\n    extensionsOrigin: utils.envOverride(\"FIREBASE_EXT_URL\", \"https://firebaseextensions.googleapis.com\"),\n    realtimeOrigin: utils.envOverride(\"FIREBASE_REALTIME_URL\", \"https://firebaseio.com\"),\n    rtdbMetadataOrigin: utils.envOverride(\"FIREBASE_RTDB_METADATA_URL\", \"https://metadata-dot-firebase-prod.appspot.com\"),\n    resourceManagerOrigin: utils.envOverride(\"FIREBASE_RESOURCEMANAGER_URL\", \"https://cloudresourcemanager.googleapis.com\"),\n    rulesOrigin: utils.envOverride(\"FIREBASE_RULES_URL\", \"https://firebaserules.googleapis.com\"),\n    runtimeconfigOrigin: utils.envOverride(\"FIREBASE_RUNTIMECONFIG_URL\", \"https://runtimeconfig.googleapis.com\"),\n    storageOrigin: utils.envOverride(\"FIREBASE_STORAGE_URL\", \"https://storage.googleapis.com\"),\n    hostingApiOrigin: utils.envOverride(\"FIREBASE_HOSTING_API_URL\", \"https://firebasehosting.googleapis.com\"),\n    cloudRunApiOrigin: utils.envOverride(\"CLOUD_RUN_API_URL\", \"https://run.googleapis.com\"),\n    serviceUsageOrigin: utils.envOverride(\"FIREBASE_SERVICE_USAGE_URL\", \"https://serviceusage.googleapis.com\"),\n    setRefreshToken: function (token) {\n        refreshToken = token;\n    },\n    setAccessToken: function (token) {\n        accessToken = token;\n    },\n    getScopes: function () {\n        return commandScopes;\n    },\n    setScopes: function (s) {\n        commandScopes = _.uniq(_.flatten([\n            scopes.EMAIL,\n            scopes.OPENID,\n            scopes.CLOUD_PROJECTS_READONLY,\n            scopes.FIREBASE_PLATFORM,\n        ].concat(s || [])));\n        logger.debug(\"> command requires scopes:\", JSON.stringify(commandScopes));\n    },\n    getAccessToken: function () {\n        return accessToken\n            ? Promise.resolve({ access_token: accessToken })\n            : require(\"./auth\").getAccessToken(refreshToken, commandScopes);\n    },\n    addRequestHeaders: function (reqOptions) {\n        _.set(reqOptions, [\"headers\", \"User-Agent\"], \"FirebaseCLI/\" + CLI_VERSION);\n        _.set(reqOptions, [\"headers\", \"X-Client-Version\"], \"FirebaseCLI/\" + CLI_VERSION);\n        return api.getAccessToken().then(function (result) {\n            _.set(reqOptions, \"headers.authorization\", \"Bearer \" + result.access_token);\n            return reqOptions;\n        });\n    },\n    request: function (method, resource, options) {\n        options = _.extend({\n            data: {},\n            origin: api.adminOrigin,\n            resolveOnHTTPError: false,\n            json: true,\n        }, options);\n        var validMethods = [\"GET\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"];\n        if (validMethods.indexOf(method) < 0) {\n            method = \"GET\";\n        }\n        var reqOptions = {\n            method: method,\n        };\n        if (options.query) {\n            resource = _appendQueryData(resource, options.query);\n        }\n        if (method === \"GET\") {\n            resource = _appendQueryData(resource, options.data);\n        }\n        else {\n            if (_.size(options.data) > 0) {\n                reqOptions.body = options.data;\n            }\n            else if (_.size(options.form) > 0) {\n                reqOptions.form = options.form;\n            }\n        }\n        reqOptions.url = options.origin + resource;\n        reqOptions.files = options.files;\n        reqOptions.resolveOnHTTPError = options.resolveOnHTTPError;\n        reqOptions.json = options.json;\n        reqOptions.qs = options.qs;\n        reqOptions.headers = options.headers;\n        reqOptions.timeout = options.timeout;\n        var requestFunction = function () {\n            return _request(reqOptions, options.logOptions);\n        };\n        if (options.auth === true) {\n            requestFunction = function () {\n                return api.addRequestHeaders(reqOptions).then(function (reqOptionsWithToken) {\n                    return _request(reqOptionsWithToken, options.logOptions);\n                });\n            };\n        }\n        return requestFunction().catch(function (err) {\n            if (options.retryCodes &&\n                _.includes(options.retryCodes, _.get(err, \"context.response.statusCode\"))) {\n                return new Promise(function (resolve) {\n                    setTimeout(resolve, 1000);\n                }).then(requestFunction);\n            }\n            return Promise.reject(err);\n        });\n    },\n    getProjects: function () {\n        logger.debug(`[WARNING] ${new Error(\"getProjects() is deprecated - update the implementation\").stack}`);\n        return api\n            .request(\"GET\", \"/v1/projects\", {\n            auth: true,\n        })\n            .then(function (res) {\n            if (res.body && res.body.projects) {\n                return res.body.projects;\n            }\n            return Promise.reject(new FirebaseError(\"Server Error: Unexpected Response. Please try again\", {\n                context: res,\n                exit: 2,\n            }));\n        });\n    },\n};\nmodule.exports = api;\n"]},"metadata":{},"sourceType":"script"}