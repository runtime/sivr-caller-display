{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst cli_color_1 = require(\"cli-color\");\n\nconst lodash_1 = require(\"lodash\");\n\nconst error_1 = require(\"./error\");\n\nconst utils_1 = require(\"./utils\");\n\nconst rc_1 = require(\"./rc\");\n\nconst config_1 = require(\"./config\");\n\nconst configstore = require(\"./configstore\");\n\nconst detectProjectRoot = require(\"./detectProjectRoot\");\n\nconst logger = require(\"./logger\");\n\nconst track = require(\"./track\");\n\nclass Command {\n  constructor(cmd) {\n    this.cmd = cmd;\n    this.name = \"\";\n    this.descriptionText = \"\";\n    this.options = [];\n\n    this.actionFn = () => {};\n\n    this.befores = [];\n    this.helpText = \"\";\n    this.name = lodash_1.first(cmd.split(\" \")) || \"\";\n  }\n\n  description(t) {\n    this.descriptionText = t;\n    return this;\n  }\n\n  option(...args) {\n    this.options.push(args);\n    return this;\n  }\n\n  before(fn, ...args) {\n    this.befores.push({\n      fn: fn,\n      args: args\n    });\n    return this;\n  }\n\n  help(t) {\n    this.helpText = t;\n    return this;\n  }\n\n  action(fn) {\n    this.actionFn = fn;\n    return this;\n  }\n\n  register(client) {\n    this.client = client;\n    const program = client.cli;\n    const cmd = program.command(this.cmd);\n\n    if (this.descriptionText) {\n      cmd.description(this.descriptionText);\n    }\n\n    this.options.forEach(args => {\n      const flags = args.shift();\n      cmd.option(flags, ...args);\n    });\n\n    if (this.helpText) {\n      cmd.on(\"--help\", () => {\n        console.log(this.helpText);\n      });\n    }\n\n    cmd.action((...args) => {\n      const runner = this.runner();\n      const start = new Date().getTime();\n      const options = lodash_1.last(args);\n\n      if (args.length - 1 > cmd._args.length) {\n        client.errorOut(new error_1.FirebaseError(`Too many arguments. Run ${cli_color_1.bold(\"firebase help \" + this.name)} for usage instructions`, {\n          exit: 1\n        }));\n        return;\n      }\n\n      runner(...args).then(result => {\n        if (utils_1.getInheritedOption(options, \"json\")) {\n          console.log(JSON.stringify({\n            status: \"success\",\n            result: result\n          }, null, 2));\n        }\n\n        const duration = new Date().getTime() - start;\n        track(this.name, \"success\", duration).then(process.exit);\n      }).catch(err => __awaiter(this, void 0, void 0, function* () {\n        if (utils_1.getInheritedOption(options, \"json\")) {\n          console.log(JSON.stringify({\n            status: \"error\",\n            error: err.message\n          }, null, 2));\n        }\n\n        const duration = Date.now() - start;\n        const errorEvent = err.exit === 1 ? \"Error (User)\" : \"Error (Unexpected)\";\n        yield Promise.all([track(this.name, \"error\", duration), track(errorEvent, \"\", duration)]);\n        client.errorOut(err);\n      }));\n    });\n  }\n\n  prepare(options) {\n    options = options || {};\n    options.project = utils_1.getInheritedOption(options, \"project\");\n\n    if (!process.stdin.isTTY || utils_1.getInheritedOption(options, \"nonInteractive\")) {\n      options.nonInteractive = true;\n    }\n\n    if (utils_1.getInheritedOption(options, \"interactive\")) {\n      options.interactive = true;\n      options.nonInteractive = false;\n    }\n\n    if (utils_1.getInheritedOption(options, \"debug\")) {\n      logger.transports.console.level = \"debug\";\n      options.debug = true;\n    }\n\n    if (utils_1.getInheritedOption(options, \"json\")) {\n      options.nonInteractive = true;\n      logger.transports.console.level = \"none\";\n    }\n\n    try {\n      options.config = config_1.load(options);\n    } catch (e) {\n      options.configError = e;\n    }\n\n    options.projectRoot = detectProjectRoot(options.cwd);\n    this.applyRC(options);\n  }\n\n  applyRC(options) {\n    const rc = rc_1.load(options.cwd);\n    options.rc = rc;\n    options.project = options.project || (configstore.get(\"activeProjects\") || {})[options.projectRoot];\n\n    if (options.config && !options.project) {\n      options.project = options.config.defaults.project;\n    }\n\n    const aliases = rc.projects;\n    const rcProject = lodash_1.get(aliases, options.project);\n\n    if (rcProject) {\n      options.projectAlias = options.project;\n      options.project = rcProject;\n    } else if (!options.project && lodash_1.size(aliases) === 1) {\n      options.projectAlias = lodash_1.head(lodash_1.keys(aliases));\n      options.project = lodash_1.head(lodash_1.values(aliases));\n    }\n  }\n\n  runner() {\n    return (...args) => __awaiter(this, void 0, void 0, function* () {\n      if (args.length === 0) {\n        args.push({});\n      }\n\n      const options = lodash_1.last(args);\n      this.prepare(options);\n\n      for (const before of this.befores) {\n        yield before.fn(options, ...before.args);\n      }\n\n      return this.actionFn(...args);\n    });\n  }\n\n}\n\nexports.Command = Command;","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/command.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","cli_color_1","require","lodash_1","error_1","utils_1","rc_1","config_1","configstore","detectProjectRoot","logger","track","Command","constructor","cmd","name","descriptionText","options","actionFn","befores","helpText","first","split","description","t","option","args","push","before","fn","help","action","register","client","program","cli","command","forEach","flags","shift","on","console","log","runner","start","Date","getTime","last","length","_args","errorOut","FirebaseError","bold","exit","getInheritedOption","JSON","stringify","status","duration","process","catch","err","error","message","now","errorEvent","all","prepare","project","stdin","isTTY","nonInteractive","interactive","transports","level","debug","config","load","configError","projectRoot","cwd","applyRC","rc","get","defaults","aliases","projects","rcProject","projectAlias","size","head","keys","values"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst cli_color_1 = require(\"cli-color\");\nconst lodash_1 = require(\"lodash\");\nconst error_1 = require(\"./error\");\nconst utils_1 = require(\"./utils\");\nconst rc_1 = require(\"./rc\");\nconst config_1 = require(\"./config\");\nconst configstore = require(\"./configstore\");\nconst detectProjectRoot = require(\"./detectProjectRoot\");\nconst logger = require(\"./logger\");\nconst track = require(\"./track\");\nclass Command {\n    constructor(cmd) {\n        this.cmd = cmd;\n        this.name = \"\";\n        this.descriptionText = \"\";\n        this.options = [];\n        this.actionFn = () => { };\n        this.befores = [];\n        this.helpText = \"\";\n        this.name = lodash_1.first(cmd.split(\" \")) || \"\";\n    }\n    description(t) {\n        this.descriptionText = t;\n        return this;\n    }\n    option(...args) {\n        this.options.push(args);\n        return this;\n    }\n    before(fn, ...args) {\n        this.befores.push({ fn: fn, args: args });\n        return this;\n    }\n    help(t) {\n        this.helpText = t;\n        return this;\n    }\n    action(fn) {\n        this.actionFn = fn;\n        return this;\n    }\n    register(client) {\n        this.client = client;\n        const program = client.cli;\n        const cmd = program.command(this.cmd);\n        if (this.descriptionText) {\n            cmd.description(this.descriptionText);\n        }\n        this.options.forEach((args) => {\n            const flags = args.shift();\n            cmd.option(flags, ...args);\n        });\n        if (this.helpText) {\n            cmd.on(\"--help\", () => {\n                console.log(this.helpText);\n            });\n        }\n        cmd.action((...args) => {\n            const runner = this.runner();\n            const start = new Date().getTime();\n            const options = lodash_1.last(args);\n            if (args.length - 1 > cmd._args.length) {\n                client.errorOut(new error_1.FirebaseError(`Too many arguments. Run ${cli_color_1.bold(\"firebase help \" + this.name)} for usage instructions`, { exit: 1 }));\n                return;\n            }\n            runner(...args)\n                .then((result) => {\n                if (utils_1.getInheritedOption(options, \"json\")) {\n                    console.log(JSON.stringify({\n                        status: \"success\",\n                        result: result,\n                    }, null, 2));\n                }\n                const duration = new Date().getTime() - start;\n                track(this.name, \"success\", duration).then(process.exit);\n            })\n                .catch((err) => __awaiter(this, void 0, void 0, function* () {\n                if (utils_1.getInheritedOption(options, \"json\")) {\n                    console.log(JSON.stringify({\n                        status: \"error\",\n                        error: err.message,\n                    }, null, 2));\n                }\n                const duration = Date.now() - start;\n                const errorEvent = err.exit === 1 ? \"Error (User)\" : \"Error (Unexpected)\";\n                yield Promise.all([track(this.name, \"error\", duration), track(errorEvent, \"\", duration)]);\n                client.errorOut(err);\n            }));\n        });\n    }\n    prepare(options) {\n        options = options || {};\n        options.project = utils_1.getInheritedOption(options, \"project\");\n        if (!process.stdin.isTTY || utils_1.getInheritedOption(options, \"nonInteractive\")) {\n            options.nonInteractive = true;\n        }\n        if (utils_1.getInheritedOption(options, \"interactive\")) {\n            options.interactive = true;\n            options.nonInteractive = false;\n        }\n        if (utils_1.getInheritedOption(options, \"debug\")) {\n            logger.transports.console.level = \"debug\";\n            options.debug = true;\n        }\n        if (utils_1.getInheritedOption(options, \"json\")) {\n            options.nonInteractive = true;\n            logger.transports.console.level = \"none\";\n        }\n        try {\n            options.config = config_1.load(options);\n        }\n        catch (e) {\n            options.configError = e;\n        }\n        options.projectRoot = detectProjectRoot(options.cwd);\n        this.applyRC(options);\n    }\n    applyRC(options) {\n        const rc = rc_1.load(options.cwd);\n        options.rc = rc;\n        options.project =\n            options.project || (configstore.get(\"activeProjects\") || {})[options.projectRoot];\n        if (options.config && !options.project) {\n            options.project = options.config.defaults.project;\n        }\n        const aliases = rc.projects;\n        const rcProject = lodash_1.get(aliases, options.project);\n        if (rcProject) {\n            options.projectAlias = options.project;\n            options.project = rcProject;\n        }\n        else if (!options.project && lodash_1.size(aliases) === 1) {\n            options.projectAlias = lodash_1.head(lodash_1.keys(aliases));\n            options.project = lodash_1.head(lodash_1.values(aliases));\n        }\n    }\n    runner() {\n        return (...args) => __awaiter(this, void 0, void 0, function* () {\n            if (args.length === 0) {\n                args.push({});\n            }\n            const options = lodash_1.last(args);\n            this.prepare(options);\n            for (const before of this.befores) {\n                yield before.fn(options, ...before.args);\n            }\n            return this.actionFn(...args);\n        });\n    }\n}\nexports.Command = Command;\n"]},"metadata":{},"sourceType":"script"}