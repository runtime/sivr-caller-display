{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst _ = require(\"lodash\");\n\nconst api = require(\"./api\");\n\nconst utils = require(\"./utils\");\n\nconst error_1 = require(\"./error\");\n\nconst POLL_INTERVAL = 10000;\nconst POLLS_BEFORE_RETRY = 12;\n\nfunction check(projectId, apiName, prefix, silent = false) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const response = yield api.request(\"GET\", `/v1/projects/${projectId}/services/${apiName}`, {\n      auth: true,\n      origin: api.serviceUsageOrigin\n    });\n    const isEnabled = _.get(response.body, \"state\") === \"ENABLED\";\n\n    if (isEnabled && !silent) {\n      utils.logLabeledSuccess(prefix, \"all necessary APIs are enabled\");\n    }\n\n    return isEnabled;\n  });\n}\n\nexports.check = check;\n\nfunction enable(projectId, apiName) {\n  return __awaiter(this, void 0, void 0, function* () {\n    return api.request(\"POST\", `/v1/projects/${projectId}/services/${apiName}:enable`, {\n      auth: true,\n      origin: api.serviceUsageOrigin\n    });\n  });\n}\n\nexports.enable = enable;\n\nfunction ensure(projectId, apiName, prefix, silent = false) {\n  return __awaiter(this, void 0, void 0, function* () {\n    if (!silent) {\n      utils.logLabeledBullet(prefix, \"ensuring necessary APIs are enabled...\");\n    }\n\n    const isEnabled = yield check(projectId, apiName, prefix, silent);\n\n    if (isEnabled) {\n      return;\n    }\n\n    if (!silent) {\n      utils.logLabeledWarning(prefix, \"missing necessary APIs. Enabling now...\");\n    }\n\n    return enableApiWithRetries(projectId, apiName, prefix, silent);\n  });\n}\n\nexports.ensure = ensure;\n\nfunction pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries, pollRetries = 0) {\n  return __awaiter(this, void 0, void 0, function* () {\n    if (pollRetries > POLLS_BEFORE_RETRY) {\n      return enableApiWithRetries(projectId, apiName, prefix, silent, enablementRetries + 1);\n    }\n\n    yield new Promise(resolve => {\n      setTimeout(resolve, POLL_INTERVAL);\n    });\n    const isEnabled = yield check(projectId, apiName, prefix, silent);\n\n    if (isEnabled) {\n      return;\n    }\n\n    if (!silent) {\n      utils.logLabeledBullet(prefix, \"waiting for APIs to activate...\");\n    }\n\n    return pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries, pollRetries + 1);\n  });\n}\n\nfunction enableApiWithRetries(projectId, apiName, prefix, silent, enablementRetries = 0) {\n  return __awaiter(this, void 0, void 0, function* () {\n    if (enablementRetries > 1) {\n      throw new error_1.FirebaseError(\"Timed out while waiting for APIs to enable. Please try again in a few minutes.\");\n    }\n\n    yield enable(projectId, apiName);\n    return pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries);\n  });\n}","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/ensureApiEnabled.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","_","require","api","utils","error_1","POLL_INTERVAL","POLLS_BEFORE_RETRY","check","projectId","apiName","prefix","silent","response","request","auth","origin","serviceUsageOrigin","isEnabled","get","body","logLabeledSuccess","enable","ensure","logLabeledBullet","logLabeledWarning","enableApiWithRetries","pollCheckEnabled","enablementRetries","pollRetries","setTimeout","FirebaseError"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst _ = require(\"lodash\");\nconst api = require(\"./api\");\nconst utils = require(\"./utils\");\nconst error_1 = require(\"./error\");\nconst POLL_INTERVAL = 10000;\nconst POLLS_BEFORE_RETRY = 12;\nfunction check(projectId, apiName, prefix, silent = false) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const response = yield api.request(\"GET\", `/v1/projects/${projectId}/services/${apiName}`, {\n            auth: true,\n            origin: api.serviceUsageOrigin,\n        });\n        const isEnabled = _.get(response.body, \"state\") === \"ENABLED\";\n        if (isEnabled && !silent) {\n            utils.logLabeledSuccess(prefix, \"all necessary APIs are enabled\");\n        }\n        return isEnabled;\n    });\n}\nexports.check = check;\nfunction enable(projectId, apiName) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return api.request(\"POST\", `/v1/projects/${projectId}/services/${apiName}:enable`, {\n            auth: true,\n            origin: api.serviceUsageOrigin,\n        });\n    });\n}\nexports.enable = enable;\nfunction ensure(projectId, apiName, prefix, silent = false) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!silent) {\n            utils.logLabeledBullet(prefix, \"ensuring necessary APIs are enabled...\");\n        }\n        const isEnabled = yield check(projectId, apiName, prefix, silent);\n        if (isEnabled) {\n            return;\n        }\n        if (!silent) {\n            utils.logLabeledWarning(prefix, \"missing necessary APIs. Enabling now...\");\n        }\n        return enableApiWithRetries(projectId, apiName, prefix, silent);\n    });\n}\nexports.ensure = ensure;\nfunction pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries, pollRetries = 0) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (pollRetries > POLLS_BEFORE_RETRY) {\n            return enableApiWithRetries(projectId, apiName, prefix, silent, enablementRetries + 1);\n        }\n        yield new Promise((resolve) => {\n            setTimeout(resolve, POLL_INTERVAL);\n        });\n        const isEnabled = yield check(projectId, apiName, prefix, silent);\n        if (isEnabled) {\n            return;\n        }\n        if (!silent) {\n            utils.logLabeledBullet(prefix, \"waiting for APIs to activate...\");\n        }\n        return pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries, pollRetries + 1);\n    });\n}\nfunction enableApiWithRetries(projectId, apiName, prefix, silent, enablementRetries = 0) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (enablementRetries > 1) {\n            throw new error_1.FirebaseError(\"Timed out while waiting for APIs to enable. Please try again in a few minutes.\");\n        }\n        yield enable(projectId, apiName);\n        return pollCheckEnabled(projectId, apiName, prefix, silent, enablementRetries);\n    });\n}\n"]},"metadata":{},"sourceType":"script"}