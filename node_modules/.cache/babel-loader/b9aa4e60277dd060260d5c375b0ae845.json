{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst request = require(\"request\");\n\nconst responseToError = require(\"../responseToError\");\n\nconst utils = require(\"../utils\");\n\nconst error_1 = require(\"../error\");\n\nconst logger = require(\"../logger\");\n\nconst api = require(\"../api\");\n\nclass RTDBListRemote {\n  constructor(instance) {\n    this.instance = instance;\n  }\n\n  listPath(path, numSubPath, startAfter, timeout) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const url = `${utils.addSubdomain(api.realtimeOrigin, this.instance)}${path}.json`;\n      const params = {\n        shallow: true,\n        limitToFirst: numSubPath\n      };\n\n      if (startAfter) {\n        params.startAfter = startAfter;\n      }\n\n      if (timeout) {\n        params.timeout = `${timeout}ms`;\n      }\n\n      const t0 = Date.now();\n      const reqOptionsWithToken = yield api.addRequestHeaders({\n        url\n      });\n      reqOptionsWithToken.qs = params;\n      const paths = yield new Promise((resolve, reject) => {\n        request.get(reqOptionsWithToken, (err, res, body) => {\n          if (err) {\n            return reject(new error_1.FirebaseError(\"Unexpected error while listing subtrees\", {\n              exit: 2,\n              original: err\n            }));\n          } else if (res.statusCode >= 400) {\n            return reject(responseToError(res, body));\n          }\n\n          let data;\n\n          try {\n            data = JSON.parse(body);\n          } catch (e) {\n            return reject(new error_1.FirebaseError(\"Malformed JSON response in shallow get \", {\n              exit: 2,\n              original: e\n            }));\n          }\n\n          if (data) {\n            return resolve(Object.keys(data));\n          }\n\n          return resolve([]);\n        });\n      });\n      const dt = Date.now() - t0;\n      logger.debug(`[database] sucessfully fetched ${paths.length} path at ${path} ${dt}`);\n      return paths;\n    });\n  }\n\n}\n\nexports.RTDBListRemote = RTDBListRemote;","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/database/listRemote.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","request","require","responseToError","utils","error_1","logger","api","RTDBListRemote","constructor","instance","listPath","path","numSubPath","startAfter","timeout","url","addSubdomain","realtimeOrigin","params","shallow","limitToFirst","t0","Date","now","reqOptionsWithToken","addRequestHeaders","qs","paths","get","err","res","body","FirebaseError","exit","original","statusCode","data","JSON","parse","keys","dt","debug","length"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst request = require(\"request\");\nconst responseToError = require(\"../responseToError\");\nconst utils = require(\"../utils\");\nconst error_1 = require(\"../error\");\nconst logger = require(\"../logger\");\nconst api = require(\"../api\");\nclass RTDBListRemote {\n    constructor(instance) {\n        this.instance = instance;\n    }\n    listPath(path, numSubPath, startAfter, timeout) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = `${utils.addSubdomain(api.realtimeOrigin, this.instance)}${path}.json`;\n            const params = {\n                shallow: true,\n                limitToFirst: numSubPath,\n            };\n            if (startAfter) {\n                params.startAfter = startAfter;\n            }\n            if (timeout) {\n                params.timeout = `${timeout}ms`;\n            }\n            const t0 = Date.now();\n            const reqOptionsWithToken = yield api.addRequestHeaders({ url });\n            reqOptionsWithToken.qs = params;\n            const paths = yield new Promise((resolve, reject) => {\n                request.get(reqOptionsWithToken, (err, res, body) => {\n                    if (err) {\n                        return reject(new error_1.FirebaseError(\"Unexpected error while listing subtrees\", {\n                            exit: 2,\n                            original: err,\n                        }));\n                    }\n                    else if (res.statusCode >= 400) {\n                        return reject(responseToError(res, body));\n                    }\n                    let data;\n                    try {\n                        data = JSON.parse(body);\n                    }\n                    catch (e) {\n                        return reject(new error_1.FirebaseError(\"Malformed JSON response in shallow get \", {\n                            exit: 2,\n                            original: e,\n                        }));\n                    }\n                    if (data) {\n                        return resolve(Object.keys(data));\n                    }\n                    return resolve([]);\n                });\n            });\n            const dt = Date.now() - t0;\n            logger.debug(`[database] sucessfully fetched ${paths.length} path at ${path} ${dt}`);\n            return paths;\n        });\n    }\n}\nexports.RTDBListRemote = RTDBListRemote;\n"]},"metadata":{},"sourceType":"script"}