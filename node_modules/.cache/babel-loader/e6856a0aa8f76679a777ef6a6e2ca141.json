{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst _ = require(\"lodash\");\n\nconst path = require(\"path\");\n\nconst clc = require(\"cli-color\");\n\nconst semver = require(\"semver\");\n\nconst error_1 = require(\"./error\");\n\nconst utils = require(\"./utils\");\n\nconst cjson = require(\"cjson\");\n\nconst MESSAGE_FRIENDLY_RUNTIMES = {\n  nodejs6: \"Node.js 6 (Deprecated)\",\n  nodejs8: \"Node.js 8\",\n  nodejs10: \"Node.js 10 (Beta)\"\n};\nconst ENGINE_RUNTIMES = {\n  6: \"nodejs6\",\n  8: \"nodejs8\",\n  10: \"nodejs10\"\n};\nexports.ENGINES_FIELD_REQUIRED_MSG = clc.bold(\"Engines field is required in package.json but none was found.\");\nexports.UNSUPPORTED_NODE_VERSION_MSG = clc.bold(`package.json in functions directory has an engines field which is unsupported. ` + `The only valid choices are: ${clc.bold('{\"node\": \"8\"}')} and ${clc.bold('{\"node\": \"10\"}')}. ` + `Note that Node.js 6 is now deprecated.`);\nexports.DEPRECATION_WARNING_MSG = clc.bold.yellow(\"functions: \") + \"Deploying functions to Node 6 runtime, which is deprecated. Node 8 is available \" + \"and is the recommended runtime.\";\nexports.FUNCTIONS_SDK_VERSION_TOO_OLD_WARNING = clc.bold.yellow(\"functions: \") + \"You must have a \" + clc.bold(\"firebase-functions\") + \" version that is at least 2.0.0. Please run \" + clc.bold(\"npm i --save firebase-functions@latest\") + \" in the functions folder.\";\n\nfunction getHumanFriendlyRuntimeName(runtime) {\n  return _.get(MESSAGE_FRIENDLY_RUNTIMES, runtime, runtime);\n}\n\nexports.getHumanFriendlyRuntimeName = getHumanFriendlyRuntimeName;\n\nfunction getRuntimeChoice(sourceDir) {\n  const packageJsonPath = path.join(sourceDir, \"package.json\");\n  const loaded = cjson.load(packageJsonPath);\n  const engines = loaded.engines;\n\n  if (!engines || !engines.node) {\n    return null;\n  }\n\n  const runtime = ENGINE_RUNTIMES[engines.node];\n\n  if (!runtime) {\n    throw new error_1.FirebaseError(exports.UNSUPPORTED_NODE_VERSION_MSG, {\n      exit: 1\n    });\n  }\n\n  if (runtime === \"nodejs6\") {\n    utils.logWarning(exports.DEPRECATION_WARNING_MSG);\n  } else {\n    if (functionsSDKTooOld(loaded)) {\n      utils.logWarning(exports.FUNCTIONS_SDK_VERSION_TOO_OLD_WARNING);\n    }\n  }\n\n  return runtime;\n}\n\nexports.getRuntimeChoice = getRuntimeChoice;\n\nfunction functionsSDKTooOld(loaded) {\n  const SDKRange = _.get(loaded, \"dependencies.firebase-functions\");\n\n  try {\n    if (!semver.intersects(SDKRange, \">=2\")) {\n      return true;\n    }\n  } catch (e) {}\n\n  return false;\n}","map":{"version":3,"sources":["/Users/Erik.Kroha1/Jobs/Verizon/Talk Home/sivr-caller-display/node_modules/firebase-tools/lib/runtimeChoiceSelector.js"],"names":["Object","defineProperty","exports","value","_","require","path","clc","semver","error_1","utils","cjson","MESSAGE_FRIENDLY_RUNTIMES","nodejs6","nodejs8","nodejs10","ENGINE_RUNTIMES","ENGINES_FIELD_REQUIRED_MSG","bold","UNSUPPORTED_NODE_VERSION_MSG","DEPRECATION_WARNING_MSG","yellow","FUNCTIONS_SDK_VERSION_TOO_OLD_WARNING","getHumanFriendlyRuntimeName","runtime","get","getRuntimeChoice","sourceDir","packageJsonPath","join","loaded","load","engines","node","FirebaseError","exit","logWarning","functionsSDKTooOld","SDKRange","intersects","e"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst _ = require(\"lodash\");\nconst path = require(\"path\");\nconst clc = require(\"cli-color\");\nconst semver = require(\"semver\");\nconst error_1 = require(\"./error\");\nconst utils = require(\"./utils\");\nconst cjson = require(\"cjson\");\nconst MESSAGE_FRIENDLY_RUNTIMES = {\n    nodejs6: \"Node.js 6 (Deprecated)\",\n    nodejs8: \"Node.js 8\",\n    nodejs10: \"Node.js 10 (Beta)\",\n};\nconst ENGINE_RUNTIMES = {\n    6: \"nodejs6\",\n    8: \"nodejs8\",\n    10: \"nodejs10\",\n};\nexports.ENGINES_FIELD_REQUIRED_MSG = clc.bold(\"Engines field is required in package.json but none was found.\");\nexports.UNSUPPORTED_NODE_VERSION_MSG = clc.bold(`package.json in functions directory has an engines field which is unsupported. ` +\n    `The only valid choices are: ${clc.bold('{\"node\": \"8\"}')} and ${clc.bold('{\"node\": \"10\"}')}. ` +\n    `Note that Node.js 6 is now deprecated.`);\nexports.DEPRECATION_WARNING_MSG = clc.bold.yellow(\"functions: \") +\n    \"Deploying functions to Node 6 runtime, which is deprecated. Node 8 is available \" +\n    \"and is the recommended runtime.\";\nexports.FUNCTIONS_SDK_VERSION_TOO_OLD_WARNING = clc.bold.yellow(\"functions: \") +\n    \"You must have a \" +\n    clc.bold(\"firebase-functions\") +\n    \" version that is at least 2.0.0. Please run \" +\n    clc.bold(\"npm i --save firebase-functions@latest\") +\n    \" in the functions folder.\";\nfunction getHumanFriendlyRuntimeName(runtime) {\n    return _.get(MESSAGE_FRIENDLY_RUNTIMES, runtime, runtime);\n}\nexports.getHumanFriendlyRuntimeName = getHumanFriendlyRuntimeName;\nfunction getRuntimeChoice(sourceDir) {\n    const packageJsonPath = path.join(sourceDir, \"package.json\");\n    const loaded = cjson.load(packageJsonPath);\n    const engines = loaded.engines;\n    if (!engines || !engines.node) {\n        return null;\n    }\n    const runtime = ENGINE_RUNTIMES[engines.node];\n    if (!runtime) {\n        throw new error_1.FirebaseError(exports.UNSUPPORTED_NODE_VERSION_MSG, { exit: 1 });\n    }\n    if (runtime === \"nodejs6\") {\n        utils.logWarning(exports.DEPRECATION_WARNING_MSG);\n    }\n    else {\n        if (functionsSDKTooOld(loaded)) {\n            utils.logWarning(exports.FUNCTIONS_SDK_VERSION_TOO_OLD_WARNING);\n        }\n    }\n    return runtime;\n}\nexports.getRuntimeChoice = getRuntimeChoice;\nfunction functionsSDKTooOld(loaded) {\n    const SDKRange = _.get(loaded, \"dependencies.firebase-functions\");\n    try {\n        if (!semver.intersects(SDKRange, \">=2\")) {\n            return true;\n        }\n    }\n    catch (e) {\n    }\n    return false;\n}\n"]},"metadata":{},"sourceType":"script"}